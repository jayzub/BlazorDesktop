@page "/settings"
@using WebviewAppShared.Data
@using System.Data

<h1>Settings:</h1> 


<div class="container">
    <div class="row">
        <div class="col-12">
            <span class="font-weight-bold" style="margin-left:2.75rem;">Sensor Configuration</span>
            
        </div>
    </div>
    <div class="row">
        <form>
            
            
            <div class="form-group row">
                    <label for="machine_no" class="col-sm-5 col-form-label">Sensor Name</label>
                    <div class="col-sm-7">
                    <input type="text" class="form-control" id="sensor_name" placeholder="cDAQ1Mod1" @bind-value="@SensorForm.S2" />
                    </div>
                    
             </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">DAQ Model</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" placeholder="NI 9230 (BNC)" @bind-value="@SensorForm.S3" />
                </div>

            </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">DAQ SerialNumber</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" placeholder="33966660" @bind-value="@SensorForm.S4" />
                </div>

            </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">Accelerometer</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" placeholder="#1 PCB 356A15 LW336579" @bind-value="@SensorForm.S5" />
                </div>

            </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">Accel X Sensitivity</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" placeholder="102.4" @bind-value="@SensorForm.S6" />
                </div>

            </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">Accel Y Sensitivity</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" placeholder="104.1" @bind-value="@SensorForm.S7" />
                </div>

            </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">Accel Z Sensitivity</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" placeholder="102.9" @bind-value="@SensorForm.S8" />
                </div>

            </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">Sampling Frequency</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" placeholder="25600" @bind-value="@SensorForm.S9" />
                </div>

            </div>

            <button type="button" class="btn btn-secondary btn-lg" @onclick="RunCommand">Add Sensor</button>
        </form>
    </div>
</div>
<br />

<div class="container">
    <div class="row">
        <div class="col-12">
            <span class="font-weight-bold" style="margin-left:2.75rem;">Machine Configuration</span>

        </div>
    </div>
<div class="row">
    <form>


        <div class="form-group row">
            <label for="machine_no" class="col-sm-5 col-form-label">Machine S.NO</label>
            <div class="col-sm-7">
                <input type="text" class="form-control" id="machine_serialNumber" placeholder="5123" @bind-value="@MachineForm.M1" />
            </div>

        </div>
        <div class="form-group row">
            <label for="machine_no" class="col-sm-5 col-form-label">Machine Name</label>
                <div class="col-sm-7">
                    <select class="form-select rounded-lg" style="width: 150px;height:30px;" asp-for="machine_name" @bind="@MachineForm.M2">
                        <option value="select" selected>-- Select --</option>
                        @foreach (var item in machines)
                        {
                            <option value=@item.Machine_Name>@item.Machine_Name</option>
                        }
                    </select>
                </div>

        </div>
           @* <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">Machine Hours</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" id="machine_serialNumber" placeholder="23345" @bind-value="@MachineForm.M3" />
                </div>

            </div>
            <div class="form-group row">
                <label for="machine_no" class="col-sm-5 col-form-label">Machine Status</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" id="machine_serialNumber" placeholder="Good" @bind-value="@MachineForm.M4" />
                </div>

            </div>*@


        <button type="button" class="btn btn-secondary btn-lg" @onclick="AddMachine">Add Machine</button>
    </form>
    
</div>
    <h2>@Message</h2>
</div>

@code{

    public Database dbConn { get; set; }
    public DataTable dataTable { get; set; }
    public S SensorForm { get; set; }
    public string query { get; set; }
    public string query_2 { get; set; }
    public string Message { get; set; }
    public string fileName { get; set; }
    public M MachineForm { get; set; }
    //public MachineModel MachineModel { get; set; }
    public List<MachineModel> machines { get; set; }

    protected override Task OnInitializedAsync()
    {
        dbConn = new Database();
        SensorForm = new S();
        MachineForm = new M();


        GetMachineType();
        //Object for Machines Model
        //MachineModel = new MachineModel();
        return base.OnInitializedAsync();
    }

    public void RunCommand()
    {
        query = "INSERT INTO S(S2, S3,S4,S5,S6,S7,S8,S9)VALUES('" + SensorForm.S2 + "','" + SensorForm.S3 + "','" + SensorForm.S4 + "','" + SensorForm.S5 + "','" + SensorForm.S6 + "','" + SensorForm.S7 + "','" + SensorForm.S8 + "','" + SensorForm.S9 + "')";
        dbConn.InsertData(query);
        SensorForm = new S();
        Message = "Data Saved!";
    }

    public void AddMachine()
    {
        //fileName = returnImageName(MachineForm.Image);
        //query = "INSERT INTO MachineDetails(SerialNumber, Image, Name)VALUES('" + MachineForm.SerialNumber + "','" + fileName + "','" +
        //    MachineForm.Name
        //    + "')";

        query_2 = $"SELECT count(*) from M where M1 = {MachineForm.M1}";
        var count = dbConn.GetCount(query_2);
        if (count == 0)
        {
            query = "INSERT INTO M(M1,M2)VALUES('" + MachineForm.M1 + "','" +
            MachineForm.M2

            + "')";
            dbConn.InsertData(query);
            MachineForm = new M();
            Message = "Data Saved!";
        }else
        {
            Message = "Already Exists!";
        }


    }
    public void GetMachineType()
    {
        //query = "SELECT * FROM Machine";
        //dataTable = dbConn.GetData(query);

        machines = new List<MachineModel>();

        MachineModel mch = new MachineModel();
        MachineModel mch2 = new MachineModel();
        MachineModel mch3 = new MachineModel();

        mch.Id = 1;
        mch.Machine_Name = "annihilator";
        machines.Add(mch);

        mch2.Id = 2;
        mch2.Machine_Name = "intimidator";
        machines.Add(mch2);

        mch3.Id = 3;
        mch3.Machine_Name = "eleminator";
        machines.Add(mch3);

        //for (int i = 0; i < dataTable.Rows.Count; i++)
        //{
        //    MachineModel mch = new MachineModel();
        //    mch.Id = Convert.ToInt32(dataTable.Rows[i]["Id"]);
        //    mch.Machine_Name = Convert.ToString(dataTable.Rows[i]["Machine_Name"]);
        //    machines.Add(mch);
        //}

    }

    public String returnImageName(String imagePath)
    {
        String[] files=imagePath.Split('\\');
        return files[files.Length - 1]; 

    }
}