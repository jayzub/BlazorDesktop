@page "/test_setup"
@using WebviewAppShared.Data
@using System.Data

<h1>Test Setup</h1> 

<span class="danger">
    @Message
</span>
<br />


<div class="container">
    <div class="row">
        <div class="btn-group btn-breadcrumb breadcrumb-default bg-dark">
            <div class="btn btn-info"><b>DEFINE</b></div>
            <a href="#" class="btn btn-default visible-lg-block visible-md-block text-white font-weight-bold">CAPTURE</a>
            <a href="#" class="btn btn-default visible-lg-block visible-md-block text-white font-weight-bold">ANALYZE></a>
            <a href="#" class="btn btn-default visible-lg-block visible-md-block text-white font-weight-bold">REVIEW</a>
        </div>
		<p></p>
    </div>

    <div class="row" style="margin-top:50px">
        <div class="col-sm-3 card bg-transparent">
            <form>
                <div class="form-group row">
                    <label for="machine_no" class="col-sm-5 col-form-label">Machine #</label>
                    <div class="col-sm-7">
                        <input type="text" class="form-control" id="machine_no" placeholder="0000" @bind-value="@objTest.MachineSerialNumber" />
                    </div>
                </div>
                <div class="form-group row">
                    <label for="hours" class="col-sm-5 col-form-label">Hours</label>
                    <div class="col-sm-7">
                        <input type="text" class="form-control" id="hours" @bind-value="@objTest.Hours" />
                    </div>
                </div>
                <div class="form-group row">
                    <label for="operator" class="col-sm-5 col-form-label">Operator</label>
                    <div class="col-sm-7">
                        <input type="text" class="form-control" id="operator" @bind-value="@objTest.Operator" />
                    </div>
                </div>
                <div class="form-group row">
                    <label for="mode" class="col-sm-5 col-form-label">Mode</label>
                    <div class="col-sm-7">
                        <input type="text" class="form-control" id="mode" @bind-value="@objTest.Mode" />
                    </div>
                </div>
                <div class="form-group row">
                    <label for="sensor_no" class="col-sm-5 col-form-label">Sensor #</label>
                    <div class="col-sm-7">
                        <input type="text" class="form-control" id="sensor_no" placeholder="0000" @bind-value="@objTest.Sensor" />
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date" class="col-sm-5 col-form-label">Date</label>
                    <div class="col-sm-7">
                        <input type="date" class="form-control" id="date" @bind-value="@objTest.Date" />
                    </div>
                </div>
            </form>
        </div>


        <div class="col-sm-9 card bg-transparent">
            <table id="maintenance-table" class="table table-image text-white">
                <thead class="bg-info">
                    <tr>
                        <th scope="col">Axis</th>
                        <th scope="col">Component</th>
                        <th scope="col">Task</th>
                        <th scope="col">Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="table-secondary text-black-50">
                        <td><input type="text" @bind-value="@objMaintenance.Axis" /></td>
                        <td><input type="text" @bind-value="@objMaintenance.Component" /></td>
                        <td><input type="text" @bind-value="@objMaintenance.Task" /></td>
                        <td><input type="text" @bind-value="@objMaintenance.Note" /></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="btn btn-secondary btn-lg">Add</button>
        </div>
    </div>
    <button type="button" class="btn btn-secondary btn-lg" @onclick="InsertData">Next</button>
</div>

@code {

    public Database dbConn { get; set; }
    public DataTable dataTable { get; set; }
    public Test objTest { get; set; }
    public List<Test> tests { get; set; }
    public Maintenance objMaintenance { get; set; }
    public List<Maintenance> maintenances { get; set; }
    public string query { get; set; }
    public string query2 { get; set; }
    public string Message { get; set; }

    protected override Task OnInitializedAsync()
    {
        dbConn = new Database();
        objTest = new Test();
        objMaintenance = new Maintenance();
        return base.OnInitializedAsync();
    }

    public void InsertData()
    {
        query = "INSERT INTO TestDetails(MachineSerialNumber, Hours, Operator, Mode, Sensor, Date)VALUES('" + objTest.MachineSerialNumber + "','" + objTest.Hours + "','" + objTest.Operator + "','" + objTest.Mode + "','" + objTest.Sensor + "','" + objTest.Date + "')";
        dbConn.InsertData(query);
        query2 = "INSERT INTO Maintenance(MachineSerialNumber, Axis, Component, Task, Note, TestId)VALUES('" + objTest.MachineSerialNumber + "','" + objMaintenance.Axis + "','" + objMaintenance.Component + "','" + objMaintenance.Task + "','" + objMaintenance.Note + "','" + objTest.TestId + "')";
        dbConn.InsertData(query2);
        objTest = new Test();
        Message = "Data Saved!";
    }

}